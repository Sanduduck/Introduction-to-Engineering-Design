<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê³µì„¤ì… â€“ í™ˆì”¨ì–´í„°</title>
  <meta name="description" content="ë°±ì—”ë“œ ì—†ì´ GitHub Pagesì—ì„œ ë°”ë¡œ ë™ì‘í•˜ëŠ” í™ˆì”¨ì–´í„° ê°¤ëŸ¬ë¦¬Â·ì˜µì…˜Â·ë¹Œë” ë‹¨ì¼ íŒŒì¼ SPA(5060 ì¹œí™” ë¸Œë¼ìš´ í…Œë§ˆ)." />
  <style>
    :root{
      /* 5060 ì¹œí™” ë¸Œë¼ìš´ íŒ”ë ˆíŠ¸ */
      --bg:#F5F1EB;         /* Ivory White */
      --ink:#3A2E25;        /* ë³¸ë¬¸ í…ìŠ¤íŠ¸ */
      --muted:#8A7E6E;      /* ë³´ì¡° í…ìŠ¤íŠ¸ */
      --accent:#B66A3D;     /* Copper Accent */
      --surface:#FFFFFF;    /* ì¹´ë“œ ë°°ê²½ */
      --surface-2:#E6DCCE;  /* ì—°í•œ í¬ë¦¼ */
      --border:#E0D6C9;     
      --chip:#F3EEE7;       
      --danger:#8b2e2e;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Arial,sans-serif;color:var(--ink);background:var(--bg)}
    a{text-decoration:none;color:inherit}

    /* í—¤ë” */
    header.site{position:sticky;top:0;z-index:20;background:rgba(245,241,235,.8);backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
    .wrap{max-width:1200px;margin:0 auto;padding:0 16px}
    .row{display:flex;align-items:center;}
    header .row{height:56px;justify-content:space-between}
    .logo{display:flex;align-items:center;gap:10px}
    .logo-b{width:28px;height:28px;background:var(--accent);border-radius:6px}
    nav.primary{display:flex;gap:8px}
    nav.primary a{padding:8px 12px;border-radius:10px}
    nav.primary a.active{background:var(--surface-2)}

    /* íˆì–´ë¡œ */
    section.hero{background:var(--surface-2);border-bottom:1px solid var(--border)}
    .hero h1{margin:0;padding:18px 0 6px;font-size:28px}
    .cta-bar{display:flex;flex-wrap:wrap;gap:8px;padding:8px 0 18px}
    .btn{padding:9px 12px;border-radius:10px;font-size:14px;border:1px solid var(--border);background:var(--surface);cursor:pointer}
    .btn:hover{filter:brightness(0.98)}
    .btn.primary{background:var(--accent);color:#fff;border-color:transparent}
    .btn.ghost{background:transparent;border-color:transparent}

    /* í•„í„°ë°” (ê°¤ëŸ¬ë¦¬) */
    aside.filters{position:sticky;top:56px;z-index:9;background:var(--bg);border-bottom:1px solid var(--border)}
    form.filters{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;padding:12px 0}
    @media(min-width:900px){form.filters{grid-template-columns:repeat(7,1fr)}}
    .field label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    .field select,.field input[type="number"],.field input[type="text"]{width:100%;padding:10px 8px;border-radius:8px;border:1px solid var(--border);background:var(--surface);font-size:14px}

    /* ì¹´ë“œ ê·¸ë¦¬ë“œ */
    section.gallery{padding:18px 0}
    ul.card-grid{list-style:none;padding:0;margin:0;display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    @media(min-width:900px){ul.card-grid{grid-template-columns:repeat(4,1fr)}}
    article.card{border:1px solid var(--border);border-radius:14px;overflow:hidden;background:var(--surface);transition:box-shadow .15s}
    article.card:hover{box-shadow:0 4px 18px rgba(0,0,0,.05)}
    .thumb{aspect-ratio:4/3;background:#EDE6DD;display:grid;place-items:center;font-size:46px}
    .card-body{padding:12px}
    .card-head{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .title{font-size:14px;font-weight:700;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
    .meta{margin-top:4px;color:var(--muted);font-size:12px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}
    .tags{margin-top:8px;display:flex;flex-wrap:wrap;gap:6px}
    .tag{background:var(--chip);color:#5a5147;border-radius:999px;padding:5px 10px;font-size:12px}
    .actions{display:flex;gap:6px;margin-top:10px}
    .chip-btn{border:1px solid var(--border);background:var(--surface);border-radius:999px;padding:6px 10px;font-size:13px;cursor:pointer}
    .chip-btn.on{background:#EED7C7;border-color:#E6C7B1}

    .more{display:grid;place-items:center;padding:10px 0 24px}

    /* ë¹Œë” */
    section.builder{padding:18px 0}
    .grid-2{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:980px){.grid-2{grid-template-columns:1.2fr .8fr}}
    .panel{border:1px solid var(--border);border-radius:14px;background:var(--surface)}
    .panel h3{margin:0;padding:12px 14px;border-bottom:1px solid var(--border);font-size:16px}
    .panel .body{padding:12px 14px}
    .builder-canvas{height:360px;border:1px dashed var(--border);border-radius:12px;background:#F1EAE2;position:relative;overflow:hidden}
    .ghost-guide{position:absolute;left:50%;top:6%;transform:translateX(-50%);width:35%;height:6px;background:rgba(182,106,61,.3);border-radius:4px}
    .seat-guide{position:absolute;left:50%;bottom:18%;transform:translateX(-50%);width:18%;height:4px;background:rgba(138,126,110,.35);border-radius:4px}
    .item{position:absolute;left:0;top:0;transform:translate(-50%,-50%);user-select:none;cursor:grab}
    .item .dot{width:28px;height:28px;display:grid;place-items:center;background:#fff;border:1px solid var(--border);border-radius:8px;box-shadow:0 1px 0 rgba(0,0,0,.04)}
    .kv{display:flex;justify-content:space-between;font-size:14px;margin:6px 0}
    .small{font-size:12px;color:var(--muted)}

    /* ì˜µì…˜ í˜ì´ì§€ */
    section.options{padding:18px 0}
    .options-grid{display:grid;gap:14px;grid-template-columns:1fr}
    @media(min-width:980px){.options-grid{grid-template-columns:1fr 1fr}}
    .opt-card{border:1px solid var(--border);border-radius:14px;background:var(--surface);overflow:hidden}
    .opt-card h4{margin:0;padding:10px 12px;border-bottom:1px solid var(--border);font-size:15px}
    .opt-body{padding:12px;display:grid;gap:10px}
    .opt-line{display:grid;grid-template-columns:120px 1fr;gap:8px;align-items:center}
    .opt-line input[type="checkbox"]{transform:scale(1.1)}

    .qty{display:inline-grid;grid-template-columns:auto 42px auto;gap:6px;align-items:center}
    .qty button{border:1px solid var(--border);background:var(--surface);border-radius:10px;padding:6px 10px;cursor:pointer}
    .qty input{width:42px;padding:6px 8px;border:1px solid var(--border);border-radius:8px;text-align:center}

    .basket{position:sticky;bottom:0;z-index:15;background:rgba(245,241,235,.92);backdrop-filter:blur(6px);border-top:1px solid var(--border)}
    .basket .wrap{display:flex;justify-content:space-between;align-items:center;padding:10px 16px}
    .basket .sum{font-weight:700}

    footer.site{border-top:1px solid var(--border);color:var(--muted);font-size:14px}
    footer .wrap{padding:24px 16px}
    .toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;background:var(--ink);color:#fff;padding:8px 10px;border-radius:8px}
    .hide{display:none}

    /* ì ‘ê·¼ì„±/ëª¨ì…˜ */
    @media (prefers-reduced-motion: reduce){.btn:hover{filter:none} html{scroll-behavior:auto}}
  </style>
</head>
<body>
  <a href="#main" class="sr-only" style="position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden">ë³¸ë¬¸ìœ¼ë¡œ ê±´ë„ˆë›°ê¸°</a>

  <header class="site" role="banner">
    <div class="wrap row">
      <div class="logo"><div class="logo-b" aria-hidden="true"></div><strong>ê³µì„¤ì… â€“ í™ˆì”¨ì–´í„°</strong></div>
      <nav class="primary" aria-label="ì£¼ìš”">
        <a href="#/gallery" id="navGallery">ê°¤ëŸ¬ë¦¬</a>
        <a href="#/options" id="navOptions">ì˜µì…˜</a>
        <a href="#/builder" id="navBuilder">ë¹Œë”</a>
      </nav>

    </div>
  </header>

  <section class="hero" aria-labelledby="hero-title">
    <div class="wrap">
      <h1 id="hero-title">SonoAI theater</h1>
      <div class="cta-bar" role="group" aria-label="ì£¼ìš” ì‘ì—…">
        <button id="btnShareView" class="btn" type="button" title="í˜„ì¬ ë³´ê¸° ê³µìœ ">í˜„ì¬ ë³´ê¸° ê³µìœ </button>
        <button class="btn ghost" type="button" id="btnAbout">ì„œë¹„ìŠ¤ ì•Œì•„ë³´ê¸°</button>
        <button class="btn primary" type="button" id="btnToBuilder">ë¹Œë”ë¡œ ì´ë™</button>
      </div>
    </div>
  </section>

  <!-- ê°¤ëŸ¬ë¦¬ ì„¹ì…˜ -->
  <aside class="filters" role="region" aria-label="í•„í„°">
    <div class="wrap">
      <form id="filterForm" class="filters" role="search">
        <div class="field"><label for="fSort">ì •ë ¬</label><select id="fSort" name="sort"><option>ì „ì²´</option><option>ìµœì‹ ìˆœ</option><option>í‰ì ìˆœ</option></select></div>
        <div class="field"><label for="fType">ì£¼ê±°í˜•íƒœ</label><select id="fType" name="type"><option>ì „ì²´</option><option>ì•„íŒŒíŠ¸</option><option>ë¹Œë¼</option><option>ì›ë£¸</option><option>ì˜¤í”¼ìŠ¤í…”</option><option>ì£¼íƒ</option></select></div>
        <div class="field"><label for="fArea">ì „ìš©ë©´ì </label><select id="fArea" name="area"><option>ì „ì²´</option><option>~10í‰</option><option>10~20í‰</option><option>20~30í‰</option><option>30í‰~</option></select></div>
        <div class="field"><label for="fRooms">ë°© ê°œìˆ˜</label><select id="fRooms" name="rooms"><option>ì „ì²´</option><option>1</option><option>2</option><option>3+</option></select></div>
        <div class="field"><label for="fBays">ë² ì´ ìˆ˜</label><select id="fBays" name="bays"><option>ì „ì²´</option><option>1</option><option>2</option><option>3+</option></select></div>
        <div class="field"><label for="fFamily">ê°€ì¡±í˜•íƒœ</label><select id="fFamily" name="family"><option>ì „ì²´</option><option>1ì¸</option><option>ë¶€ë¶€</option><option>ì•„ì´ë™ë°˜</option><option>ë°˜ë ¤ë™ë¬¼</option></select></div>
        <div class="field"><label for="fStyle">ìŠ¤íƒ€ì¼</label><select id="fStyle" name="style"><option>ì „ì²´</option><option>ëª¨ë˜</option><option>ë¯¸ë‹ˆë©€</option><option>ë‚´ì¶”ëŸ´</option><option>ë¹ˆí‹°ì§€</option><option>ë¶ìœ ëŸ½</option></select></div>
      </form>
    </div>
  </aside>

  <main id="main">
    <!-- GALLERY -->
    <section id="page-gallery" class="gallery" aria-labelledby="gallery-title">
      <div class="wrap">
        <h2 id="gallery-title" class="sr-only" style="position:absolute;left:-9999px;width:1px;height:1px;overflow:hidden">ê°¤ëŸ¬ë¦¬</h2>
        <ul id="grid" class="card-grid" role="list"></ul>
        <div class="more"><button id="btnMore" class="btn" type="button">ë”ë³´ê¸°</button></div>
      </div>
    </section>

    <!-- OPTIONS -->
    <section id="page-options" class="options" aria-labelledby="options-title" hidden>
      <div class="wrap">
        <h2 id="options-title" style="margin:0 0 10px 0">ì˜µì…˜ ì„ íƒ</h2>
        <p class="small">ë°°ë¯¼ ë§ˆë¼íƒ• ì˜µì…˜ì²˜ëŸ¼ **ìˆ˜ëŸ‰**ê³¼ **í•„ìˆ˜ ì„ íƒ**ì„ ì§€ì›í•©ë‹ˆë‹¤. ì„ íƒì€ ì•„ë˜ ì¥ë°”êµ¬ë‹ˆì— ëª¨ì´ê³ , ë¹Œë”ë¡œ ì´ë™í•´ ë°°ì¹˜/ê²¬ì ì— ë°˜ì˜ë©ë‹ˆë‹¤.</p>
        <div id="optionsGrid" class="options-grid"></div>
        <div style="margin-top:12px" class="actions">
          <button id="btnOptionsClear" class="btn" type="button">ì˜µì…˜ ì„ íƒ ì´ˆê¸°í™”</button>
        </div>
      </div>
      <!-- í•˜ë‹¨ ì¥ë°”êµ¬ë‹ˆ ë°” -->
      <div class="basket" aria-label="ì˜µì…˜ ì¥ë°”êµ¬ë‹ˆ">
        <div class="wrap">
          <div>
            <div class="small">ì„ íƒ í•­ëª© <span id="basketCount">0</span>ê°œ</div>
            <div class="sum" id="basketSum">0 ì›</div>
          </div>
          <div>
            <button id="btnOptionsToBuilder" class="btn primary" type="button">ë‹´ê¸° Â· ë¹Œë”ë¡œ</button>
          </div>
        </div>
      </div>
    </section>

    <!-- BUILDER -->
    <section id="page-builder" class="builder" aria-labelledby="builder-title" hidden>
      <div class="wrap">
        <h2 id="builder-title" style="margin:0 0 10px 0">ë‚˜ë§Œì˜ í™ˆì”¨ì–´í„° ë¹Œë”</h2>
        <div class="grid-2">
          <!-- ì¢Œ: ìº”ë²„ìŠ¤ -->
          <section class="panel" aria-label="ë°°ì¹˜">
            <h3>ë°°ì¹˜</h3>
            <div class="body">
              <div id="canvas" class="builder-canvas" aria-label="ë°© ë°°ì¹˜ ìº”ë²„ìŠ¤">
                <div class="ghost-guide" title="ìŠ¤í¬ë¦° ê°€ì´ë“œ"></div>
                <div class="seat-guide" title="ì¢Œì„ ê°€ì´ë“œ"></div>
              </div>
              <p class="small">ì•„ì´í…œì„ ìº”ë²„ìŠ¤ì—ì„œ ë“œë˜ê·¸í•´ ë°°ì¹˜í•˜ì„¸ìš”. (ì¢Œí‘œ ìë™ ì €ì¥)</p>
            </div>
          </section>
          <!-- ìš°: ì„ íƒ/ìš”ì•½ -->
          <aside class="panel" aria-label="ì„ íƒ í•­ëª©">
            <h3>ì„ íƒ í•­ëª©</h3>
            <div class="body" id="selectedList"></div>
            <div class="body" id="summaryBox">
              <div class="kv"><span>ì´ ê°€ê²©</span><strong id="sumPrice">0 ì›</strong></div>
              <div class="kv"><span>ì˜ˆìƒ ì†Œë¹„ì „ë ¥</span><strong id="sumPower">0 W</strong></div>
              <div class="kv"><span>ì˜ˆìƒ ì†ŒìŒ(í‰ê· )</span><strong id="sumNoise">0 dB</strong></div>
              <div class="kv"><span>ì¶”ì²œ ì‹œì²­ ê±°ë¦¬</span><strong id="sumView">2.5 m</strong></div>
              <div class="actions" style="margin-top:12px">
                <button id="btnShareBuild" class="btn" type="button">ì„¤ê³„ ê³µìœ </button>
                <button id="btnClear" class="btn" type="button">ì´ˆê¸°í™”</button>
              </div>
            </div>
            <div class="body">
              <div class="kv" style="margin-top:8px"><span class="small">ë¶ë§ˆí¬ ë¶ˆëŸ¬ì˜¤ê¸°</span></div>
              <div id="bookmarksBox" class="small">(ë¶ë§ˆí¬ê°€ ì—†ìŠµë‹ˆë‹¤)</div>
            </div>
          </aside>
        </div>
      </div>
    </section>
  </main>

  <div id="toast" class="toast hide" role="status" aria-live="polite"></div>

  <footer class="site" role="contentinfo">
  </footer>

  <script>
  // ===================== ë”ë¯¸ ë°ì´í„°(ê°¤ëŸ¬ë¦¬) =====================
  const DEMO = [
    mk({ id: "p1", title: "ì‹œë„¤ë§ˆ ê±°ì‹¤ 24í‰", thumb: "ğŸ¬", type: "ì•„íŒŒíŠ¸", area: "20~30í‰", rooms: "3+", bays: "3+", family: "ë¶€ë¶€", style: "ëª¨ë˜", tags: ["í™ˆì”¨ì–´í„°","ì•”ë§‰","ì‚¬ìš´ë“œë°”"], pop: 99, rating: 4.8, ts: 1728000000000 }),
    mk({ id: "p2", title: "ë¶ìœ ëŸ½ ì›ë£¸ 10í‰", thumb: "ğŸ›‹ï¸", type: "ì›ë£¸", area: "~10í‰", rooms: "1", bays: "1", family: "1ì¸", style: "ë¶ìœ ëŸ½", tags: ["ìš°ë“œ","ì¡°ëª…"], pop: 76, rating: 4.5, ts: 1723000000000 }),
    mk({ id: "p3", title: "ë¹Œë¼ ë‚´ì¶”ëŸ´ 18í‰", thumb: "ğŸŒ¿", type: "ë¹Œë¼", area: "10~20í‰", rooms: "2", bays: "2", family: "ë¶€ë¶€", style: "ë‚´ì¶”ëŸ´", tags: ["íŒ¨ë¸Œë¦­","ê·¸ë¦°"], pop: 65, rating: 4.2, ts: 1721000000000 }),
    ...Array.from({length:36}).map((_,i)=> mk({ id: `m${i}`, title: `ì•„íŒŒíŠ¸ 25í‰ ë°ëª¨ ${i+1}`, thumb: i%3?"ğŸ¡":"ğŸ ", type: "ì•„íŒŒíŠ¸", area: "20~30í‰", rooms: "3+", bays: (i%2?"2":"3+"), family: (i%3?"ë¶€ë¶€":"ì•„ì´ë™ë°˜"), style: (i%2?"ëª¨ë˜":"ë‚´ì¶”ëŸ´"), tags:["í™”ì´íŠ¸","ìš°ë“œ"], pop: 50+(i%40), rating: 3.5+(i%5)*0.2, ts: 1710000000000 + i*10000000 }))
  ];
  function mk(o){ return Object.assign({tags:[],pop:0,rating:0,ts:Date.now()}, o); }

  // ===================== ì˜µì…˜ ë°ì´í„° =====================
  const OPTIONS = [
    { id:'base-projector', icon:'ğŸï¸', name:'ê¸°ë³¸ í”„ë¡œì í„°(í•„ìˆ˜ ì„ íƒ)', base:{price:590000, power:160, noise:28}, required:true,
      desc:'í•„ìˆ˜ ë² ì´ìŠ¤. ì´ˆë‹¨ì´ˆì ê³¼ëŠ” ë³„ë„ ì„ íƒ ê°€ëŠ¥.', params:[{key:'base-res',label:'í•´ìƒë„',type:'select',options:['FHD','4K']}]},

    { id:'ust-projector', icon:'ğŸ“½ï¸', name:'ì´ˆë‹¨ì´ˆì  í”„ë¡œì í„°', base:{price:1890000, power:220, noise:24},
      desc:'ë²½ ë°€ì°© ì„¤ì¹˜, ê·¸ë¦¼ì ìµœì†Œí™”', params:[{key:'resolution',label:'í•´ìƒë„',type:'select',options:['FHD','4K']},{key:'speaker',label:'ìŠ¤í”¼ì»¤ ì„±ëŠ¥',type:'select',options:['í‘œì¤€','í”„ë¦¬ë¯¸ì—„']}] },

    { id:'ai-light', icon:'ğŸ’¡', name:'AI ì¡°ëª… ì‹œìŠ¤í…œ', base:{price:300000, power:18, noise:0},
      desc:'ì˜ìƒ/ì¥ë©´ì— ë§ì¶° ë°ê¸°Â·ìƒ‰ì˜¨ë„ ìë™ ì¡°ì ˆ', params:[{key:'mode', label:'ì—°ì¶œ ëª¨ë“œ', type:'select', options:['ì˜í™”','ìŠ¤í¬ì¸ ','ìŒì•…','ìˆ˜ë©´']}], qtyMax:4, unit:'ì„¸íŠ¸' },

    { id:'motor-curtain', icon:'ğŸªŸ', name:'ì „ë™ ì•”ë§‰ì»¤íŠ¼', base:{price:400000, power:8, noise:25},
      desc:'ìë™ ì—´Â·ë‹«í˜(ì°¨ê´‘ 90% ê¶Œì¥)', params:[{key:'opacity',label:'ì°¨ê´‘',type:'select',options:['80%','90%','100%']}], qtyMax:2, unit:'ì„¸íŠ¸' },

    { id:'smart-table', icon:'ğŸ”', name:'ìŠ¤ë§ˆíŠ¸ ë°°ë‹¬ í…Œì´ë¸”', base:{price:450000, power:15, noise:10},
      desc:'í…Œì´ë¸” ë‚´ì¥ íƒœë¸”ë¦¿OS', params:[{key:'os',label:'OS',type:'select',options:['Android','Linux']}], qtyMax:4, unit:'ëŒ€' },

    { id:'fiber-ceiling', icon:'âœ¨', name:'ì²œì¥ ê´‘ì„¬ìœ  ì¡°ëª…', base:{price:380000, power:12, noise:0},
      desc:'ì€ì€í•œ ë³„ë¹›ìœ¼ë¡œ ëª…ì•”ë¹„ í–¥ìƒ', qtyMax:3, unit:'ì„¸íŠ¸' },

    { id:'haptic-chair', icon:'ğŸª‘', name:'ë©€í‹°ê°ê° ì²´í—˜ ì˜ì', base:{price:1200000, power:60, noise:30},
      desc:'í–¥ê¸°/ì˜¨ë„/ì§„ë™ ì—°ë™', qtyMax:4, unit:'ì¢Œì„' },

    { id:'auto-side-table', icon:'ğŸ§‘â€ğŸ’»', name:'AI í…Œì´ë¸”(ìë™ ì´ë™)', base:{price:250000, power:10, noise:20},
      desc:'ì†ë™ì‘ ì¸ì‹ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì´ë™', params:[{key:'speed',label:'ì†ë„',type:'select',options:['ëŠë¦¼','ë³´í†µ','ë¹ ë¦„']}], qtyMax:2, unit:'ëŒ€', safety:'ì¶©ëŒ ë°©ì§€ ì„¼ì„œ í•„ìš”(ë°ëª¨)' },

    { id:'vr-ar-avatar', icon:'ğŸ§‘â€ğŸ¤â€ğŸ§‘', name:'VR-AR ë™ì‹œ ì‹œì²­(ì•„ë°”íƒ€)', base:{price:0, power:0, noise:0},
      desc:'VR í—¤ë“œì…‹ í•„ìš”(ë°ëª¨ UI)', params:[{key:'presence',label:'ì¡´ì¬ê°',type:'select',options:['ë¼ì´íŠ¸','í‘œì¤€','ëª°ì…']}] },

    { id:'ai-assistant', icon:'ğŸ™ï¸', name:'AI ëŒ€í™”í˜• ì–´ì‹œìŠ¤í„´íŠ¸', base:{price:0, power:0, noise:0},
      desc:'ë°°ìš°/ì´¬ì˜ì§€ ë“± ìŒì„± Q&A(ë°ëª¨)', params:[{key:'wake',label:'í˜¸ì¶œì–´',type:'text',placeholder:'ì˜ˆ: ì‹œë„¤ë§ˆì•¼'}] },

    { id:'ai-replay', icon:'ğŸ§ ', name:'AI ê°ì • ìŠ¤í† ë¦¬ë³´ë“œ ë¦¬í”Œë ˆì´', base:{price:0, power:0, noise:0},
      desc:'ì‹œì„ /í‘œì •/ë°˜ì‘ ë°ì´í„° ê¸°ë°˜ í•˜ì´ë¼ì´íŠ¸(ë°ëª¨)', params:[{key:'privacy',label:'í”„ë¼ì´ë²„ì‹œ',type:'select',options:['ê¸°ê¸°ë‚´ ì²˜ë¦¬','í´ë¼ìš°ë“œ']}] },

    { id:'taste-sensor', icon:'ğŸ‘…', name:'ë¯¸ê° ì „ê¸°ìê·¹ ì„¼ì„œ(ì‹¤í—˜ìš©)', base:{price:0, power:0, noise:0},
      desc:'AR ìŒì‹ ì—°ë™ ë¯¸ê° ìê·¹(ì‹¤í—˜/ì•ˆì „ í™•ì¸ ì „ ë¯¸ì‚¬ìš©)', safety:'ì¸ì²´ ìê·¹ ì¥ì¹˜: ì˜ë£ŒÂ·ì•ˆì „ ê²€ì¦ ì „ ì‹œì—°ìš© UIë§Œ êµ¬í˜„' }
  ];

  // ===================== ì „ì—­ ìƒíƒœ =====================
  const state = {
    filters: { sort:'ì „ì²´', type:'ì „ì²´', area:'ì „ì²´', rooms:'ì „ì²´', bays:'ì „ì²´', family:'ì „ì²´', style:'ì „ì²´' },
    limit: 12,
    likes: JSON.parse(localStorage.getItem('likes.v1')||'{}'),
    bookmarks: JSON.parse(localStorage.getItem('bookmarks.v1')||'[]'),
    builder: JSON.parse(localStorage.getItem('builder.v1')||'{}'), // {items:[{id,name,price,power,noise,pos}], room:{w,d}}
    options: JSON.parse(localStorage.getItem('options.v2')||'{}')  // {id:{qty:number, params:{}, required:boolean}}
  };

  // ===================== ë¼ìš°íŒ… =====================
  const pageGallery = document.getElementById('page-gallery');
  const pageOptions = document.getElementById('page-options');
  const pageBuilder = document.getElementById('page-builder');
  const navGallery = document.getElementById('navGallery');
  const navOptions = document.getElementById('navOptions');
  const navBuilder = document.getElementById('navBuilder');

  function route(){
    const hash = location.hash || '#/gallery';
    const path = hash.split('?')[0];
    const isGallery = path.startsWith('#/gallery');
    const isOptions = path.startsWith('#/options');
    pageGallery.hidden = !isGallery;
    pageOptions.hidden = !isOptions;
    pageBuilder.hidden = isGallery || isOptions;
    navGallery.classList.toggle('active', isGallery);
    navOptions.classList.toggle('active', isOptions);
    navBuilder.classList.toggle('active', !isGallery && !isOptions);
  }
  window.addEventListener('hashchange', route);

  // ===================== ì—˜ë¦¬ë¨¼íŠ¸ ì°¸ì¡° =====================
  const grid = document.getElementById('grid');
  const toast = document.getElementById('toast');
  const fSort = document.getElementById('fSort');
  const fType = document.getElementById('fType');
  const fArea = document.getElementById('fArea');
  const fRooms = document.getElementById('fRooms');
  const fBays = document.getElementById('fBays');
  const fFamily = document.getElementById('fFamily');
  const fStyle = document.getElementById('fStyle');
  const btnMore = document.getElementById('btnMore');
  const btnShareView = document.getElementById('btnShareView');
  const btnToBuilder = document.getElementById('btnToBuilder');

  // ë¹Œë”
  const canvas = document.getElementById('canvas');
  const selectedList = document.getElementById('selectedList');
  const sumPrice = document.getElementById('sumPrice');
  const sumPower = document.getElementById('sumPower');
  const sumNoise = document.getElementById('sumNoise');
  const sumView = document.getElementById('sumView');
  const btnShareBuild = document.getElementById('btnShareBuild');
  const btnClear = document.getElementById('btnClear');
  const bookmarksBox = document.getElementById('bookmarksBox');

  // ì˜µì…˜
  const optionsGrid = document.getElementById('optionsGrid');
  const btnOptionsToBuilder = document.getElementById('btnOptionsToBuilder');
  const btnOptionsClear = document.getElementById('btnOptionsClear');
  const basketCount = document.getElementById('basketCount');
  const basketSum = document.getElementById('basketSum');

  // ===================== ê°¤ëŸ¬ë¦¬ ë¡œì§ =====================
  function applyFiltersAndSort(list, f){
    let arr = list.filter(x =>
      (f.type==='ì „ì²´' || x.type===f.type) &&
      (f.area==='ì „ì²´' || x.area===f.area) &&
      (f.rooms==='ì „ì²´' || x.rooms===f.rooms) &&
      (f.bays==='ì „ì²´' || x.bays===f.bays) &&
      (f.family==='ì „ì²´' || x.family===f.family) &&
      (f.style==='ì „ì²´' || x.style===f.style)
    );
    if(f.sort==='ì „ì²´') arr.sort((a,b)=>b.pop-a.pop);
    if(f.sort==='ìµœì‹ ìˆœ') arr.sort((a,b)=>b.ts-a.ts);
    if(f.sort==='í‰ì ìˆœ') arr.sort((a,b)=>b.rating-a.rating);
    return arr;
  }

  function renderGallery(){
    const arr = applyFiltersAndSort(DEMO, state.filters).slice(0, state.limit);
    grid.innerHTML = '';
    for(const p of arr){
      const li = document.createElement('li');
      li.innerHTML = cardHTML(p, !!state.likes[p.id], isBookmarked(p.id));
      grid.appendChild(li);
    }
    // ë°”ì¸ë”©
    grid.querySelectorAll('button[data-like]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-like');
        state.likes[id] = !state.likes[id];
        localStorage.setItem('likes.v1', JSON.stringify(state.likes));
        renderGallery();
      })
    });
    grid.querySelectorAll('button[data-bookmark]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-bookmark');
        const data = DEMO.find(x=>x.id===id);
        toggleBookmark(data);
        renderGallery();
        showToast(isBookmarked(id) ? 'ë¶ë§ˆí¬ì— ì¶”ê°€ë¨' : 'ë¶ë§ˆí¬ í•´ì œ');
        renderBookmarksBox();
      })
    });
    grid.querySelectorAll('button[data-to-builder]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-to-builder');
        const data = DEMO.find(x=>x.id===id);
        const item = toBuilderItem(data);
        addToBuilder(item);
        location.hash = '#/builder';
      })
    });
  }

  function cardHTML(p, liked, bookmarked){
    const tags = p.tags.map(t=>`<span class="tag">${escapeHTML(t)}</span>`).join('');
    return `
      <article class="card" aria-labelledby="title-${p.id}">
        <figure class="thumb" aria-label="ì¸ë„¤ì¼">${escapeHTML(p.thumb)}</figure>
        <div class="card-body">
          <div class="card-head">
            <h3 id="title-${p.id}" class="title">${escapeHTML(p.title)}</h3>
            <div class="small">${escapeHTML(p.type)} Â· ${escapeHTML(p.area)}</div>
          </div>
          <p class="meta">ìŠ¤íƒ€ì¼: ${escapeHTML(p.style)} Â· í‰ì  ${p.rating.toFixed(1)}</p>
          <div class="tags" aria-label="íƒœê·¸">${tags}</div>
          <div class="actions">
            <button class="chip-btn ${liked?'on':''}" data-like="${p.id}" type="button">${liked?'â™¥ ë¶ë§ˆí¬ë¨':'â™¡ ì¢‹ì•„ìš”'}</button>
            <button class="chip-btn ${bookmarked?'on':''}" data-bookmark="${p.id}" type="button">${bookmarked?'â˜… ë¶ë§ˆí¬ í•´ì œ':'â˜† ë¶ë§ˆí¬'}</button>
            <button class="chip-btn" data-to-builder="${p.id}" type="button">ì´ êµ¬ì„±ìœ¼ë¡œ ë¹Œë”</button>
          </div>
        </div>
      </article>`;
  }

  function isBookmarked(id){ return state.bookmarks.some(x=>x.id===id); }
  function toggleBookmark(data){
    const exists = isBookmarked(data.id);
    if(exists){ state.bookmarks = state.bookmarks.filter(x=>x.id!==data.id); }
    else { state.bookmarks = [...state.bookmarks, { id:data.id, title:data.title, thumb:data.thumb }]; }
    localStorage.setItem('bookmarks.v1', JSON.stringify(state.bookmarks));
  }

  // ===================== ì˜µì…˜ í˜ì´ì§€ ë¡œì§ (ë°°ë¯¼-ë§ˆë¼íƒ• ìŠ¤íƒ€ì¼) =====================
  function renderOptions(){
    optionsGrid.innerHTML = '';
    OPTIONS.forEach(opt=>{
      const sel = state.options[opt.id] || { qty: opt.required? 1 : 0, params:{} };
      const qty = sel.qty||0;
      const div = document.createElement('div');
      div.className = 'opt-card';
      const priceLine = `${fmt(opt.base.price)}ì›${opt.unit?` / ${opt.unit}`:''}`;
      div.innerHTML = `
        <h4>${opt.icon} ${escapeHTML(opt.name)} ${opt.required?'<span class="small" style="margin-left:6px;color:var(--danger)">í•„ìˆ˜</span>':''}</h4>
        <div class="opt-body">
          <div class="small">${escapeHTML(opt.desc || '')}</div>
          ${opt.safety ? `<div class="small" style="color:var(--danger)">ì•ˆì „/ìœ¤ë¦¬: ${escapeHTML(opt.safety)}</div>` : ''}
          ${opt.depends ? `<div class="small">ì˜ì¡´ì„±: ${escapeHTML(opt.depends)}</div>` : ''}
          ${(opt.params||[]).map(p => paramLine(opt.id, p, sel.params[p.key])).join('')}
          <div class="kv"><span>ê°€ê²©</span><strong>${priceLine}</strong></div>
          <div class="kv" aria-label="ìˆ˜ëŸ‰ ì¡°ì ˆ">
            <span>ìˆ˜ëŸ‰${opt.required?' (ìµœì†Œ 1)': ''}</span>
            <span class="qty">
              <button type="button" data-dec="${opt.id}">-</button>
              <input id="qty-${opt.id}" value="${qty}" inputmode="numeric" aria-label="ìˆ˜ëŸ‰" readonly>
              <button type="button" data-inc="${opt.id}">+</button>
            </span>
          </div>
        </div>`;
      optionsGrid.appendChild(div);
    });

    // íŒŒë¼ë¯¸í„° ë°”ì¸ë”©
    optionsGrid.querySelectorAll('[data-param-key]').forEach(el=>{
      el.addEventListener('change',()=>{
        const id = el.getAttribute('data-opt');
        const key = el.getAttribute('data-param-key');
        state.options[id] = state.options[id] || {qty:0, params:{}};
        state.options[id].params[key] = el.value;
        persistOptions();
        renderBasket();
      })
    });

    // ìˆ˜ëŸ‰ ìŠ¤í…Œí¼ ë°”ì¸ë”©
    optionsGrid.querySelectorAll('button[data-inc]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-inc');
        incQty(id, +1);
      })
    });
    optionsGrid.querySelectorAll('button[data-dec]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-dec');
        incQty(id, -1);
      })
    });

    renderBasket();
  }

  function paramLine(optId, p, val){
    if(p.type==='select'){
      const opts = p.options.map(o=>`<option ${val===o?'selected':''}>${escapeHTML(o)}</option>`).join('');
      return `<div class="opt-line"><label for="${optId}-${p.key}">${escapeHTML(p.label)}</label><select id="${optId}-${p.key}" data-opt="${optId}" data-param-key="${p.key}">${opts}</select></div>`;
    }
    if(p.type==='text'){
      return `<div class="opt-line"><label for="${optId}-${p.key}">${escapeHTML(p.label)}</label><input type="text" id="${optId}-${p.key}" data-opt="${optId}" data-param-key="${p.key}" placeholder="${escapeHTML(p.placeholder||'')}" value="${escapeHTML(val||'')}"></div>`;
    }
    if(p.type==='number'){
      return `<div class="opt-line"><label for="${optId}-${p.key}">${escapeHTML(p.label)}</label><input type="number" id="${optId}-${p.key}" data-opt="${optId}" data-param-key="${p.key}" value="${escapeHTML(val||'')}"></div>`;
    }
    return '';
  }

  function incQty(id, delta){
    const meta = OPTIONS.find(o=>o.id===id); if(!meta) return;
    const max = meta.qtyMax || 99; const min = meta.required ? 1 : 0;
    state.options[id] = state.options[id] || {qty:0, params:{}};
    const cur = state.options[id].qty||0;
    const next = clamp(cur + delta, min, max);
    state.options[id].qty = next;
    const input = document.getElementById('qty-'+id); if(input) input.value = next;
    persistOptions();
    renderBasket();
  }

  function persistOptions(){ localStorage.setItem('options.v2', JSON.stringify(state.options)); }

  function getBasket(){
    const entries = Object.entries(state.options);
    const items = [];
    for(const [id,conf] of entries){
      const meta = OPTIONS.find(o=>o.id===id); if(!meta) continue;
      const qty = +conf.qty||0; if(qty<=0) continue;
      const unit = meta.unit? ` x${qty} ${meta.unit}` : (qty>1?` x${qty}`:'');
      items.push({
        id: 'opt-'+id,
        name: `${meta.name}${unit}${confSuffix(conf.params)}`,
        price: meta.base.price * qty,
        power: meta.base.power * qty,
        noise: meta.base.noise, // ì†ŒìŒì€ í‰ê·  ê°€ì •
        icon: meta.icon,
        qty
      });
    }
    return items;
  }

  function renderBasket(){
    const items = getBasket();
    const total = items.reduce((a,b)=>a+(+b.price||0),0);
    basketCount.textContent = items.reduce((a,b)=>a+(+b.qty||0),0);
    basketSum.textContent = fmt(total)+' ì›';
  }

  btnOptionsToBuilder?.addEventListener('click',()=>{
    // í•„ìˆ˜ í•­ëª© í™•ì¸
    const requiredMetas = OPTIONS.filter(o=>o.required);
    for(const m of requiredMetas){
      const sel = state.options[m.id];
      if(!sel || !sel.qty || sel.qty<1){ showToast(`í•„ìˆ˜ ì˜µì…˜: "${m.name}"ì„(ë¥¼) 1 ì´ìƒ ì„ íƒí•˜ì„¸ìš”`); return; }
    }
    const basket = getBasket();
    if(!basket.length){ showToast('ì„ íƒëœ ì˜µì…˜ì´ ì—†ìŠµë‹ˆë‹¤'); return; }
    basket.forEach(addToBuilder);
    showToast('ì˜µì…˜ì´ ë¹Œë”ì— ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
    location.hash = '#/builder';
  });

  function confSuffix(params){
    if(!params) return '';
    const keys = Object.keys(params).filter(k=>params[k]);
    if(!keys.length) return '';
    return ' ['+ keys.map(k=>`${k}:${params[k]}`).join(', ') +']';
  }

  btnOptionsClear?.addEventListener('click',()=>{ state.options = {}; persistOptions(); renderOptions(); renderBasket(); });

  // ===================== ë¹Œë” ë¡œì§ =====================
  function toBuilderItem(p){
    return { id:p.id, name:p.title, price:300000, power:120, noise:28, pos:{x:50,y:70}, icon:p.thumb };
  }

  function addToBuilder(item){
    const cur = state.builder.items || [];
    state.builder.items = [...cur, item];
    persistBuilder();
    renderBuilder();
  }

  function renderBuilder(){
    const items = state.builder.items || [];
    selectedList.innerHTML = items.length? '' : '<div class="small">ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤. ê°¤ëŸ¬ë¦¬/ì˜µì…˜ì—ì„œ ì¶”ê°€í•˜ì„¸ìš”.</div>';
    items.forEach((it, idx)=>{
      const row = document.createElement('div');
      row.className = 'kv';
      row.innerHTML = `<span>${escapeHTML(it.name)}</span>
        <span>
          <button class="chip-btn" data-move="${idx}" type="button">ë°°ì¹˜</button>
          <button class="chip-btn" data-del="${idx}" type="button">ì‚­ì œ</button>
        </span>`;
      selectedList.appendChild(row);
    });

    const price = items.reduce((a,b)=>a+(+b.price||0),0);
    const power = items.reduce((a,b)=>a+(+b.power||0),0);
    const noiseList = items.map(i=>+i.noise||0).filter(n=>n>0);
    const noise = noiseList.length ? Math.round(noiseList.reduce((a,b)=>a+b,0)/noiseList.length) : 0;
    const screenInch = 100; // ë°ëª¨ ê³ ì •
    const viewDist = (screenInch/100)*2.5;
    sumPrice.textContent = fmt(price)+ ' ì›';
    sumPower.textContent = power + ' W';
    sumNoise.textContent = noise + ' dB';
    sumView.textContent = viewDist.toFixed(1) + ' m';

    renderCanvas();

    selectedList.querySelectorAll('button[data-del]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const i = +btn.getAttribute('data-del');
        (state.builder.items||[]).splice(i,1);
        persistBuilder();
        renderBuilder();
      })
    });
    selectedList.querySelectorAll('button[data-move]').forEach(btn=>{
      btn.addEventListener('click',()=>{ const i = +btn.getAttribute('data-move'); focusItemOnCanvas(i); })
    });
  }

  function renderCanvas(){
    canvas.innerHTML = '<div class="ghost-guide"></div><div class="seat-guide"></div>';
    const items = state.builder.items || [];
    items.forEach((it, idx)=>{
      const el = document.createElement('div');
      el.className = 'item';
      el.style.left = (it.pos?.x||50) + '%';
      el.style.top  = (it.pos?.y||70) + '%';
      el.setAttribute('data-idx', idx);
      el.innerHTML = `<div class="dot" title="${escapeHTML(it.name)}">${escapeHTML(it.icon||'ğŸ”§')}</div>`;
      canvas.appendChild(el);
    });
    canvas.querySelectorAll('.item').forEach(el=>{
      el.addEventListener('mousedown', startDrag);
      el.addEventListener('touchstart', startDrag, {passive:false});
    });
  }

  function startDrag(ev){
    ev.preventDefault();
    const el = ev.currentTarget;
    const idx = +el.getAttribute('data-idx');
    const rect = canvas.getBoundingClientRect();
    const start = getPos(ev);
    const init = { x: (state.builder.items[idx].pos?.x)||50, y:(state.builder.items[idx].pos?.y)||70 };
    function move(e){
      const p = getPos(e);
      const dx = p.x - start.x; const dy = p.y - start.y;
      const nx = clamp(init.x + (dx/rect.width)*100, 0, 100);
      const ny = clamp(init.y + (dy/rect.height)*100, 0, 100);
      el.style.left = nx+'%'; el.style.top = ny+'%';
      state.builder.items[idx].pos = { x:nx, y:ny };
    }
    function up(){
      window.removeEventListener('mousemove', move);
      window.removeEventListener('mouseup', up);
      window.removeEventListener('touchmove', move);
      window.removeEventListener('touchend', up);
      persistBuilder();
    }
    window.addEventListener('mousemove', move);
    window.addEventListener('mouseup', up);
    window.addEventListener('touchmove', move);
    window.addEventListener('touchend', up);
  }

  function getPos(e){ const t = e.touches? e.touches[0] : e; return { x:t.clientX, y:t.clientY }; }
  function clamp(n,a,b){ return Math.min(b, Math.max(a,n)); }
  function fmt(n){ try{return Number(n||0).toLocaleString('ko-KR')}catch{return n+''} }

  function focusItemOnCanvas(i){ const el = canvas.querySelector(`.item[data-idx="${i}"]`); if(!el) return; el.animate([{transform:'translate(-50%,-50%) scale(1)'},{transform:'translate(-50%,-50%) scale(1.12)'}],{duration:200}); }

  function renderBookmarksBox(){
    const list = state.bookmarks;
    if(!list.length){ bookmarksBox.textContent = '(ë¶ë§ˆí¬ê°€ ì—†ìŠµë‹ˆë‹¤)'; return; }
    bookmarksBox.innerHTML = '';
    list.forEach(b=>{
      const div = document.createElement('div');
      div.className = 'kv';
      div.innerHTML = `<span>${escapeHTML(b.title)}</span>
        <span>
          <button class="chip-btn" data-import="${b.id}" type="button">ë¹Œë”ë¡œ ê°€ì ¸ì˜¤ê¸°</button>
          <button class="chip-btn" data-rm="${b.id}" type="button">ì‚­ì œ</button>
        </span>`;
      bookmarksBox.appendChild(div);
    });
    bookmarksBox.querySelectorAll('button[data-import]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-import');
        const src = state.bookmarks.find(x=>x.id===id);
        if(!src) return;
        addToBuilder({ id:src.id, name:src.title, price:300000, power:120, noise:28, pos:{x:50,y:70}, icon:src.thumb });
        showToast('ë¶ë§ˆí¬ì—ì„œ ì¶”ê°€ë¨');
      })
    });
    bookmarksBox.querySelectorAll('button[data-rm]').forEach(btn=>{
      btn.addEventListener('click',()=>{
        const id = btn.getAttribute('data-rm');
        state.bookmarks = state.bookmarks.filter(x=>x.id!==id);
        localStorage.setItem('bookmarks.v1', JSON.stringify(state.bookmarks));
        renderBookmarksBox();
      })
    });
  }

  function persistBuilder(){ localStorage.setItem('builder.v1', JSON.stringify(state.builder)); }

  // ===================== ê³µìœ /í¼ì‹œìŠ¤íŠ¸ =====================
  function persistFilters(){
    try{
      const s = JSON.stringify({filters:state.filters,limit:state.limit});
      localStorage.setItem('interior3d.gallery.v1', s);
      const hash = btoa(encodeURIComponent(s));
      if(location.hash.startsWith('#/gallery')){
        history.replaceState(null,'', '#/gallery?state='+hash);
      }
    }catch{}
  }
  function restoreFiltersFromHash(){
    try{
      const q = new URLSearchParams((location.hash.split('?')[1]||''));
      const h = q.get('state'); if(!h) return;
      const json = decodeURIComponent(atob(h));
      const obj = JSON.parse(json);
      if(obj.filters) state.filters = obj.filters;
      if(obj.limit) state.limit = obj.limit;
    }catch{}
  }

  // ===================== ìœ í‹¸ =====================
  function escapeHTML(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c])); }
  function showToast(msg){ toast.textContent = msg; toast.classList.remove('hide'); clearTimeout(showToast._t); showToast._t=setTimeout(()=>toast.classList.add('hide'),1500); }

  // ===================== ì´ë²¤íŠ¸/ì´ˆê¸°í™” =====================
  ;(function init(){
    // í•„í„° UI ì´ˆê¸°ê°’ ë³µì›
    restoreFiltersFromHash();
    const f = state.filters;
    fSort.value=f.sort; fType.value=f.type; fArea.value=f.area; fRooms.value=f.rooms; fBays.value=f.bays; fFamily.value=f.family; fStyle.value=f.style;
    // í•„í„° ë³€ê²½
    ;[fSort,fType,fArea,fRooms,fBays,fFamily,fStyle].forEach(sel=> sel.addEventListener('change',()=>{
      state.filters = { sort:fSort.value, type:fType.value, area:fArea.value, rooms:fRooms.value, bays:fBays.value, family:fFamily.value, style:fStyle.value };
      state.limit = Math.max(12, state.limit);
      persistFilters();
      renderGallery();
    }));

    btnMore.addEventListener('click',()=>{ state.limit+=12; persistFilters(); renderGallery(); });
    btnShareView.addEventListener('click',()=>{
      try{ const s = JSON.stringify({filters:state.filters,limit:state.limit}); const h=btoa(encodeURIComponent(s)); const url=location.origin+location.pathname+'#/gallery?state='+h; navigator.clipboard&&navigator.clipboard.writeText(url); showToast('í˜„ì¬ ë³´ê¸° ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤'); }catch{ showToast('ê³µìœ  ì‹¤íŒ¨'); }
    });
    btnToBuilder.addEventListener('click',()=>{ location.hash = '#/builder'; });

    btnShareBuild.addEventListener('click',()=>{
      try{ const s = btoa(encodeURIComponent(JSON.stringify(state.builder||{}))); const url = location.origin+location.pathname+'#/builder?build='+s; navigator.clipboard&&navigator.clipboard.writeText(url); showToast('ì„¤ê³„ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤'); }catch{ showToast('ê³µìœ  ì‹¤íŒ¨'); }
    });
    btnClear.addEventListener('click',()=>{ state.builder={}; persistBuilder(); renderBuilder(); renderCanvas(); });

    // ì˜µì…˜ í˜ì´ì§€ ì´ˆê¸° ë Œë”
    renderOptions();

    // ë¹Œë”: í•´ì‹œë¡œ ì„¤ê³„ ë¶ˆëŸ¬ì˜¤ê¸°
    (function restoreBuildFromHash(){
      try{ const qs = new URLSearchParams(location.hash.split('?')[1]||''); const b = qs.get('build'); if(!b) return; const json = decodeURIComponent(atob(b)); const obj = JSON.parse(json); if(obj && obj.items) { state.builder=obj; persistBuilder(); } }catch{}
    })();

    renderGallery();
    renderBuilder();
    renderBookmarksBox();
    route();
  })();
  </script>
</body>
</html>
